<!DOCTYPE html>
<html>
  <head>
    <title>Grade PDF - ICP Grader</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        font-family: "Roboto", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
      <!-- Header -->
      <header class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-semibold text-gray-800">ICP Grader</h2>
          <a href="/" class="text-sm text-blue-600 hover:text-blue-800"
            >← Back to Browser</a
          >
        </div>
      </header>

      <!-- Main Container -->
      <div class="flex flex-1 overflow-hidden">
        <!-- LEFT: PDF VIEWER -->
        <div class="w-2/3 p-4 bg-gray-100">
          <div class="h-full bg-white rounded-lg shadow-sm overflow-hidden">
            <iframe
              src="{{ url_for('view_pdf', filepath=filepath) }}"
              class="w-full h-full border-0"
            >
            </iframe>
          </div>
        </div>

        <!-- RIGHT: Grading Panel -->
        <div class="w-1/3 bg-white border-l border-gray-200 overflow-y-auto">
          <div class="p-6">
            <!-- Criterion Title -->
            <div class="mb-6">
              <h3 id="criterion-title" class="text-xl font-bold text-gray-800 mb-2"></h3>
              <p class="text-sm text-gray-600">
                Total Marks:
                <span id="total-marks" class="font-semibold"></span>
              </p>
            </div>

            <!-- Comment Options -->
            <div class="mb-6 space-y-3">
              <label class="text-sm font-medium text-gray-700 block mb-3"
                >Grading Criteria:</label
              >
              <div id="comments-container"></div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex gap-3">
              <button
                id="prev-btn"
                class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium text-center disabled:opacity-50 disabled:cursor-not-allowed"
              >
                ← Previous
              </button>
              
              <button
                id="next-btn"
                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-center"
              >
                Next →
              </button>
              
              <button
                id="done-btn"
                class="hidden flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-center"
              >
                Done
              </button>
            </div>

            <!-- Info Note -->
            <div
              class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"
            >
              <p class="text-xs text-yellow-800">
                <strong>Note:</strong> Grading functionality will be added
                later. Currently viewing criteria only.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Load rubric data from Flask
      const RUBRIC = {{ rubric_data|safe }};
      const RUBRIC_KEYS = {{ rubric_keys|safe }};
      let currentIndex = 0;

      function updateDisplay() {
        const currentKey = RUBRIC_KEYS[currentIndex];
        const currentRubric = RUBRIC[currentKey];
        
        // Update title and marks
        document.getElementById('criterion-title').textContent = currentKey;
        document.getElementById('total-marks').textContent = currentRubric.marks;
        
        // Update comments
        const commentsContainer = document.getElementById('comments-container');
        commentsContainer.innerHTML = '';
        
        currentRubric.comments.forEach((comment, index) => {
          const commentDiv = document.createElement('label');
          commentDiv.className = 'flex items-start p-3 border-2 rounded-lg cursor-pointer transition-all border-gray-200 hover:border-blue-300 hover:bg-gray-50';
          commentDiv.innerHTML = `
            <input
              type="radio"
              name="grade_${currentKey}"
              value="${index}"
              class="mt-1 mr-3 text-blue-600 w-4 h-4"
            />
            <div class="flex-2">
              <div class="flex justify-between items-start mb-1">
                <p class="text-sm text-gray-800">${comment}</p>
              </div>
            </div>
          `;
          commentsContainer.appendChild(commentDiv);
        });
        
        // Update buttons
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const doneBtn = document.getElementById('done-btn');
        
        // Show/hide and enable/disable previous button
        prevBtn.disabled = currentIndex === 0;
        
        // Show next or done button
        if (currentIndex === RUBRIC_KEYS.length - 1) {
          nextBtn.classList.add('hidden');
          doneBtn.classList.remove('hidden');
        } else {
          nextBtn.classList.remove('hidden');
          doneBtn.classList.add('hidden');
        }
      }

      // Event listeners
      document.getElementById('prev-btn').addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateDisplay();
        }
      });

      document.getElementById('next-btn').addEventListener('click', () => {
        if (currentIndex < RUBRIC_KEYS.length - 1) {
          currentIndex++;
          updateDisplay();
        }
      });

      document.getElementById('done-btn').addEventListener('click', () => {
        window.location.href = '/';
      });

      // Initialize display
      updateDisplay();
    </script>
  </body>
</html>